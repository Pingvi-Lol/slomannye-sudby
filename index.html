<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–°–ª–æ–º–∞–Ω–Ω—ã–µ —Å—É–¥—å–±—ã ‚Äî —Å–µ–∑–æ–Ω—ã</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="site-header">
    <h1>–°–ª–æ–º–∞–Ω–Ω—ã–µ —Å—É–¥—å–±—ã</h1>
    <nav>
      <a href="index.html">–°–µ–∑–æ–Ω—ã</a>
      <a href="admin.html">–ê–¥–º–∏–Ω</a>
    </nav>
  </header>

  <main class="container">
    <h2 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–∑–æ–Ω</h2>
    <div id="seasonsGrid" class="seasons-grid"></div>
    <p class="muted">–°–µ–∑–æ–Ω—ã 3 –∏ 4 –∑–∞–∫—Ä—ã—Ç—ã –ø–æ–∫–∞ —á—Ç–æ</p>
  </main>

<script>
const LOCAL_KEY = 'slomannye_seasons_v1';
const DEFAULT_JSON = 'seasons.json';

function showLockedNotice(){
  alert('–°–µ–∑–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –û–Ω –≤—ã–π–¥–µ—Ç –ø–æ–∑–∂–µ.');
}

async function loadData(){
  // —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º localStorage
  const raw = localStorage.getItem(LOCAL_KEY);
  if(raw){
    try{ return JSON.parse(raw); }catch(e){}
  }
  // –µ—Å–ª–∏ –Ω–µ—Ç localStorage –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
  try{
    const res = await fetch(DEFAULT_JSON);
    if(res.ok){
      const json = await res.json();
      localStorage.setItem(LOCAL_KEY, JSON.stringify(json));
      return json;
    }
  }catch(e){}
  // –ø—É—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
  return { seasons: [] };
}

function createSeasonCard(s, idx){
  const div = document.createElement('div');
  div.className = 'season-card';
  div.innerHTML = `
    <h3>${s.title}</h3>
    <p class="season-meta">–°–µ–∑–æ–Ω ${idx+1} ‚Ä¢ —ç–ø–∏–∑–æ–¥–æ–≤ ${ (s.episodes||[]).length }</p>
    <div class="season-actions">
      <a class="btn" href="season.html?i=${idx}" ${s.locked? 'onclick="event.preventDefault();showLockedNotice();"' : ''}>–û—Ç–∫—Ä—ã—Ç—å</a>
    </div>
    ${s.locked ? '<div class="lock">üîí –ó–∞–∫—Ä—ã—Ç</div>' : ''}
  `;
  return div;
}

(async function init(){
  const data = await loadData();
  const grid = document.getElementById('seasonsGrid');
  grid.innerHTML = '';
  (data.seasons || []).forEach((s, i)=>{
    grid.appendChild(createSeasonCard(s,i));
  });
})();
</script>
</body>
</html>
